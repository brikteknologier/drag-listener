// Generated by CoffeeScript 1.6.2
(function() {
  var EventEmitter;

  EventEmitter = require('events').EventEmitter;

  module.exports = function(parent, handle, offsetMin, offsetMax) {
    var emitter, page;

    if (typeof handle !== 'object') {
      offsetMax = offsetMin;
      offsetMin = handle;
      handle = parent;
    }
    handle = $(handle);
    parent = $(parent);
    page = $('body');
    emitter = new EventEmitter();
    handle.on('mousedown', function(downEvent) {
      var complete, drag, handleStartX, hasDragged, max, min, percentOfXVal, startTime;

      handleStartX = parent.position().left;
      min = typeof offsetMin === 'function' ? offsetMin() : offsetMin;
      max = typeof offsetMax === 'function' ? offsetMax() : offsetMax;
      downEvent.preventDefault();
      percentOfXVal = function(x) {
        return (x - min) / (max - min);
      };
      startTime = Date.now();
      hasDragged = false;
      drag = function(dragEvent) {
        var currentX, offsetX, potentialX;

        if (!hasDragged) {
          emitter.emit('dragStart', percentOfXVal(parent.position().left));
          hasDragged = true;
        }
        offsetX = dragEvent.pageX - downEvent.pageX;
        currentX = parent.position().left;
        potentialX = handleStartX + offsetX;
        if (min > potentialX) {
          if (currentX === min) {
            return;
          }
          potentialX = min;
        } else if (max < potentialX) {
          if (currentX === max) {
            return;
          }
          potentialX = max;
        }
        return emitter.emit('drag', percentOfXVal(potentialX));
      };
      complete = function() {
        page.off('mousemove', drag);
        page.off('mouseup', complete);
        if (hasDragged) {
          return emitter.emit('dragFinish', percentOfXVal(parent.position().left));
        } else if (Date.now() - startTime < 500) {
          return emitter.emit('click');
        }
      };
      page.on('mousemove', drag);
      return page.on('mouseup', complete);
    });
    return emitter;
  };

}).call(this);
